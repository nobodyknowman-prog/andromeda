<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محاكاة المسكن الفضائي - ناسا</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/exporters/GLTFExporter.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #000 url('https://images.unsplash.com/photo-1462331940025-496dfbfc7564?ixlib=rb-1.2.1&auto=format&fit=crop&w=2000&q=80') no-repeat center center fixed;
            background-size: cover;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 10, 30, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 0.8s ease;
        }
        
        .welcome-content {
            text-align: center;
            max-width: 800px;
            padding: 30px;
        }
        
        .welcome-title {
            font-size: 48px;
            color: #4fc3f7;
            margin-bottom: 30px;
            text-shadow: 0 0 15px rgba(79, 195, 247, 0.7);
        }
        
        .welcome-subtitle {
            font-size: 24px;
            color: #b3e5fc;
            margin-bottom: 40px;
        }
        
        .astronauts-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 40px 0;
        }
        
        .astronaut-card {
            background: rgba(30, 40, 90, 0.7);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(79, 195, 247, 0.3);
            transition: transform 0.3s ease;
        }
        
        .astronaut-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(79, 195, 247, 0.3);
        }
        
        .astronaut-name {
            font-size: 18px;
            color: #4fc3f7;
            margin-bottom: 10px;
        }
        
        .astronaut-role {
            font-size: 14px;
            color: #b3e5fc;
        }
        
        .start-button {
            background: #0288d1;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 20px;
            margin-top: 30px;
            transition: all 0.3s;
        }
        
        .start-button:hover {
            background: #039be5;
            box-shadow: 0 0 20px rgba(2, 136, 209, 0.7);
            transform: scale(1.05);
        }
        
        .container {
            display: flex;
            min-height: 100vh;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .sidebar {
            width: 350px;
            background: rgba(10, 15, 40, 0.95);
            padding: 20px;
            border-left: 1px solid rgba(0, 150, 255, 0.3);
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
            font-size: 28px;
        }
        
        .control-group {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(79, 195, 247, 0.2);
        }
        
        h2 {
            color: #29b6f6;
            margin-bottom: 15px;
            font-size: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        h3 {
            color: #4fc3f7;
            margin: 10px 0;
            font-size: 16px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #b3e5fc;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            background: rgba(20, 30, 70, 0.7);
            border: 1px solid #29b6f6;
            border-radius: 5px;
            color: white;
            margin-bottom: 15px;
        }
        
        button {
            background: #0288d1;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
            font-size: 16px;
        }
        
        button:hover {
            background: #039be5;
            box-shadow: 0 0 10px rgba(2, 136, 209, 0.7);
        }
        
        .crew-member {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(30, 40, 90, 0.5);
            border-radius: 5px;
        }
        
        .crew-name {
            flex: 1;
            margin-left: 10px;
        }
        
        .remove-btn {
            background: #f44336;
            width: auto;
            padding: 5px 10px;
            margin: 0;
        }
        
        .remove-btn:hover {
            background: #e53935;
        }
        
        #simulation-container {
            flex: 1;
            background: rgba(5, 10, 30, 0.7);
            position: relative;
            overflow: hidden;
        }
        
        #space-station {
            width: 100%;
            height: 100%;
        }
        
        .info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(10, 15, 40, 0.9);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(79, 195, 247, 0.3);
            max-width: 300px;
            z-index: 5;
        }
        
        .info-item {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }
        
        .info-label {
            color: #b3e5fc;
        }
        
        .info-value {
            color: #4fc3f7;
            font-weight: bold;
        }
        
        .nasa-logo {
            text-align: center;
            margin-top: 20px;
            opacity: 0.7;
        }
        
        .view-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 5;
        }
        
        .view-btn {
            width: auto;
            padding: 8px 15px;
            background: rgba(10, 15, 40, 0.8);
            border: 1px solid #29b6f6;
        }
        
        .details-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(10, 15, 40, 0.95);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(79, 195, 247, 0.3);
            max-width: 450px;
            display: none;
            z-index: 5;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .details-panel h3 {
            margin-top: 0;
            color: #4fc3f7;
        }
        
        .details-list {
            list-style-type: none;
        }
        
        .details-list li {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(79, 195, 247, 0.2);
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: transparent;
            color: #f44336;
            width: auto;
            padding: 5px;
            margin: 0;
            font-size: 18px;
        }
        
        .material-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(30, 40, 90, 0.5);
            border-radius: 5px;
        }
        
        .material-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-left: 10px;
        }
        
        .section-content {
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .section-content.collapsed {
            max-height: 0;
            overflow: hidden;
        }
        
        .toggle-icon {
            transition: transform 0.3s ease;
        }
        
        .toggle-icon.rotated {
            transform: rotate(180deg);
        }
        
        .room-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .room-btn {
            background: rgba(20, 30, 70, 0.7);
            border: 1px solid #29b6f6;
            color: white;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
        }
        
        .room-btn.active {
            background: #0288d1;
        }
        
        .room-size-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .size-btn {
            flex: 1;
            background: rgba(20, 30, 70, 0.7);
            border: 1px solid #29b6f6;
            color: white;
            padding: 5px;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
        }
        
        .size-btn.active {
            background: #0288d1;
        }
        
        .compliance-indicator {
            position: absolute;
            top: 20px;
            left: 380px;
            width: 20px;
            height: 120px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            z-index: 10;
        }
        
        .compliance-green {
            height: 40px;
            background: #4CAF50;
        }
        
        .compliance-yellow {
            height: 40px;
            background: #FFC107;
        }
        
        .compliance-red {
            height: 40px;
            background: #F44336;
        }
        
        .compliance-labels {
            position: absolute;
            top: 20px;
            left: 410px;
            color: white;
            z-index: 10;
        }
        
        .compliance-label {
            margin-bottom: 28px;
            font-size: 12px;
        }
        
        .trip-type {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .trip-btn {
            background: rgba(20, 30, 70, 0.7);
            border: 1px solid #29b6f6;
            color: white;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
        }
        
        .trip-btn.active {
            background: #0288d1;
        }
        
        .ai-recommendation {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4CAF50;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .room-type-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .room-type-btn {
            background: rgba(20, 30, 70, 0.7);
            border: 1px solid #29b6f6;
            color: white;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
        }
        
        .room-type-btn.active {
            background: #0288d1;
        }
        
        .room-quantity-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .quantity-btn {
            background: rgba(20, 30, 70, 0.7);
            border: 1px solid #29b6f6;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .quantity-display {
            font-size: 18px;
            font-weight: bold;
            color: #4fc3f7;
        }
        
        .ai-applied {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4CAF50;
            padding: 5px 10px;
            border-radius: 5px;
            margin-top: 5px;
            font-size: 12px;
            display: inline-block;
        }
        
        .simulation-active {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(10, 15, 40, 0.9);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #4fc3f7;
            text-align: center;
            z-index: 20;
            display: none;
        }
        
        .simulation-title {
            font-size: 24px;
            color: #4fc3f7;
            margin-bottom: 15px;
        }
        
        .simulation-status {
            font-size: 18px;
            color: #b3e5fc;
            margin-bottom: 20px;
        }
        
        .simulation-progress {
            width: 100%;
            height: 20px;
            background: rgba(20, 30, 70, 0.7);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #0288d1, #4fc3f7);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .station-details-section {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(79, 195, 247, 0.2);
        }
        
        .station-details-section h4 {
            color: #4fc3f7;
            margin-bottom: 8px;
        }
        
        .station-details-section p {
            margin-bottom: 5px;
            line-height: 1.5;
        }
        
        .material-specs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .material-spec {
            background: rgba(30, 40, 90, 0.5);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        
        .material-name {
            font-weight: bold;
            color: #4fc3f7;
        }
        
        .material-percentage {
            font-size: 18px;
            color: #b3e5fc;
            margin-top: 5px;
        }
        
        .camera-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 5;
        }
        
        .camera-btn {
            width: auto;
            padding: 8px 15px;
            background: rgba(10, 15, 40, 0.8);
            border: 1px solid #29b6f6;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .action-btn {
            flex: 1;
            background: rgba(20, 30, 70, 0.7);
            border: 1px solid #29b6f6;
            color: white;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
        }
        
        .action-btn.delete {
            background: rgba(244, 67, 54, 0.7);
            border: 1px solid #f44336;
        }
        
        .action-btn.export {
            background: rgba(76, 175, 80, 0.7);
            border: 1px solid #4CAF50;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-left: none;
                border-bottom: 1px solid rgba(0, 150, 255, 0.3);
            }
            
            #simulation-container {
                height: 60vh;
            }
            
            .view-controls {
                top: 10px;
                right: 10px;
            }
            
            .info-panel, .details-panel {
                left: 10px;
                right: 10px;
                max-width: none;
            }
            
            .compliance-indicator, .compliance-labels {
                display: none;
            }
            
            .astronauts-list {
                grid-template-columns: 1fr;
            }
            
            .welcome-title {
                font-size: 36px;
            }
            
            .welcome-subtitle {
                font-size: 18px;
            }
            
            .material-specs {
                grid-template-columns: 1fr;
            }
            
            .camera-controls {
                bottom: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="welcome-screen" id="welcome-screen">
        <div class="welcome-content">
            <h1 class="welcome-title">محاكاة المسكن الفضائي</h1>
            <p class="welcome-subtitle">نظام الذكاء الاصطناعي الرياضي - ناسا</p>
            
            <div class="astronauts-list">
                <div class="astronaut-card">
                    <div class="astronaut-name">صلاح الدين عامر</div>
                    <div class="astronaut-role">قائد البعثة</div>
                </div>
                <div class="astronaut-card">
                    <div class="astronaut-name">علي الربيعي</div>
                    <div class="astronaut-role">مهندس أنظمة</div>
                </div>
                <div class="astronaut-card">
                    <div class="astronaut-name">المهندس علي الاكبر</div>
                    <div class="astronaut-role">اختصاصي حمولة</div>
                </div>
                <div class="astronaut-card">
                    <div class="astronaut-name">زهراء علي</div>
                    <div class="astronaut-role">عالمة أحياء</div>
                </div>
                <div class="astronaut-card">
                    <div class="astronaut-name">دعاء راشد</div>
                    <div class="astronaut-role">طبيبة البعثة</div>
                </div>
                <div class="astronaut-card">
                    <div class="astronaut-name">نور عبدالزهرة</div>
                    <div class="astronaut-role">اختصاصية اتصالات</div>
                </div>
            </div>
            
            <button class="start-button" id="start-button">بدء المحاكاة</button>
        </div>
    </div>
    
    <div class="compliance-indicator">
        <div class="compliance-red"></div>
        <div class="compliance-yellow"></div>
        <div class="compliance-green"></div>
    </div>
    
    <div class="compliance-labels">
        <div class="compliance-label">مشكلة</div>
        <div class="compliance-label">تحذير</div>
        <div class="compliance-label">ممتاز</div>
    </div>
    
    <div class="container" id="main-container">
        <div class="sidebar" id="sidebar">
            <h1>محاكاة المسكن الفضائي</h1>
            
            <div class="control-group">
                <h2 id="destination-section">
                    الوجهة ونوع الرحلة
                    <span class="toggle-icon">▼</span>
                </h2>
                <div class="section-content" id="destination-content">
                    <select id="destination">
                        <option value="iss">محطة الفضاء الدولية (ISS)</option>
                        <option value="moon">القمر</option>
                        <option value="mars">المريخ</option>
                        <option value="deep-space">الفضاء العميق</option>
                    </select>
                    
                    <div class="trip-type">
                        <div class="trip-btn" id="one-way">ذهاب فقط</div>
                        <div class="trip-btn active" id="round-trip">ذهاب وعودة</div>
                    </div>
                    
                    <div id="moon-options" style="display: none;">
                        <label for="moon-duration">مدة البقاء على القمر (أيام)</label>
                        <input type="number" id="moon-duration" value="7" min="1" max="30">
                    </div>
                    
                    <div class="ai-recommendation" id="ai-recommendation">
                        <!-- سيتم ملء التوصيات هنا -->
                    </div>
                </div>
            </div>
            
            <div class="control-group">
                <h2 id="crew-section">
                    طاقم الرحلة
                    <span class="toggle-icon">▼</span>
                </h2>
                <div class="section-content" id="crew-content">
                    <div id="crew-list">
                        <!-- سيتم إضافة أفراد الطاقم هنا ديناميكيًا -->
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="crew-name" placeholder="اسم رائد الفضاء">
                        <button id="add-crew">إضافة</button>
                    </div>
                </div>
            </div>
            
            <div class="control-group">
                <h2 id="rooms-section">
                    التحكم بالغرف
                    <span class="toggle-icon">▼</span>
                </h2>
                <div class="section-content" id="rooms-content">
                    <div class="room-controls">
                        <div class="room-btn active" data-room="control">غرفة التحكم</div>
                        <div class="room-btn" data-room="lab">المختبر</div>
                        <div class="room-btn" data-room="bedroom">غرف النوم</div>
                        <div class="room-btn" data-room="kitchen">المطبخ</div>
                        <div class="room-btn" data-room="bathroom">الحمام</div>
                        <div class="room-btn" data-room="storage">التخزين</div>
                    </div>
                    
                    <div class="room-type-controls">
                        <div class="room-type-btn active" data-type="standard">قياسي</div>
                        <div class="room-type-btn" data-type="advanced">متقدم</div>
                        <div class="room-type-btn" data-type="luxury">فاخر</div>
                        <div class="room-type-btn" data-type="compact">مدمج</div>
                    </div>
                    
                    <div class="room-size-controls">
                        <div class="size-btn active" data-size="small">صغير</div>
                        <div class="size-btn" data-size="medium">متوسط</div>
                        <div class="size-btn" data-size="large">كبير</div>
                    </div>
                    
                    <div class="room-quantity-controls">
                        <div class="quantity-btn" id="decrease-room">-</div>
                        <div class="quantity-display" id="room-quantity">1</div>
                        <div class="quantity-btn" id="increase-room">+</div>
                        <span>عدد الغرف</span>
                    </div>
                    
                    <div id="room-info" style="margin-top: 10px; padding: 10px; background: rgba(30,40,90,0.5); border-radius: 5px;">
                        <h4>معلومات الغرفة</h4>
                        <div id="room-details">اختر غرفة لعرض التفاصيل</div>
                    </div>
                </div>
            </div>
            
            <div class="control-group">
                <h2 id="supplies-section">
                    المؤن والموارد
                    <span class="toggle-icon">▼</span>
                </h2>
                <div class="section-content" id="supplies-content">
                    <div class="info-item">
                        <span class="info-label">الطعام المطلوب:</span>
                        <span class="info-value" id="food-required">0 كجم</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">الماء المطلوب:</span>
                        <span class="info-value" id="water-required">0 لتر</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">الأكسجين المطلوب:</span>
                        <span class="info-value" id="oxygen-required">0 كجم</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">الطاقة المطلوبة:</span>
                        <span class="info-value" id="power-required">0 كيلوواط/ساعة</span>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn delete" id="clear-model">مسح النموذج</button>
                <button class="action-btn export" id="export-model">تصدير النموذج</button>
            </div>
            
            <button id="simulate-btn">تشغيل المحاكاة</button>
            <button id="reset-view">إعادة تعيين المنظر</button>
            
            <div class="nasa-logo">
                <p>نظام الذكاء الاصطناعي الرياضي - ناسا</p>
                <p>NASA AI Mathematical System</p>
            </div>
        </div>
        
        <div class="main-content">
            <div id="simulation-container">
                <div class="view-controls">
                    <button class="view-btn" id="exterior-view">منظر خارجي</button>
                    <button class="view-btn" id="interior-view">منظر داخلي</button>
                    <button class="view-btn" id="details-btn">تفاصيل المسكن</button>
                </div>
                
                <div class="camera-controls">
                    <button class="camera-btn" id="camera-front">منظر أمامي</button>
                    <button class="camera-btn" id="camera-back">منظر خلفي</button>
                    <button class="camera-btn" id="camera-top">منظر علوي</button>
                    <button class="camera-btn" id="camera-bottom">منظر سفلي</button>
                </div>
                
                <div id="space-station"></div>
                
                <div class="info-panel">
                    <h3>معلومات المسكن الفضائي</h3>
                    <div class="info-item">
                        <span class="info-label">الحجم الإجمالي:</span>
                        <span class="info-value" id="total-volume">0 م³</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">عدد أفراد الطاقم:</span>
                        <span class="info-value" id="crew-count">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">مدة الرحلة:</span>
                        <span class="info-value" id="mission-duration-display">0 يوم</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">الوجهة:</span>
                        <span class="info-value" id="destination-display">-</span>
                    </div>
                </div>
                
                <div class="details-panel" id="details-panel">
                    <button class="close-btn" id="close-details">×</button>
                    <h3>تفاصيل المسكن الفضائي - مواصفات ناسا</h3>
                    <div id="station-details">
                        <!-- سيتم ملء التفاصيل هنا ديناميكيًا -->
                    </div>
                </div>
                
                <div class="simulation-active" id="simulation-active">
                    <div class="simulation-title">المحاكاة قيد التشغيل</div>
                    <div class="simulation-status" id="simulation-status">جاري تحميل البيانات...</div>
                    <div class="simulation-progress">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                    <button id="stop-simulation">إيقاف المحاكاة</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // معلومات ناسا الحقيقية للمسكن الفضائي
        const nasaStationSpecs = {
            dimensions: {
                length: 25, // متر
                diameter: 8, // متر
                doorDiameter: 1.5 // متر
            },
            materials: {
                external: {
                    name: "ألياف الكربون",
                    percentage: 45,
                    color: 0x2c3e50,
                    description: "لتحمل الإشعاعات والميكانيكا الصعبة",
                    texture: "carbon_fiber"
                },
                internal: {
                    name: "ألمنيوم عالي المقاومة",
                    percentage: 30,
                    color: 0xbdc3c7,
                    description: "لتقليل الوزن وامتصاص الصدمات",
                    texture: "aluminum"
                },
                thermal: {
                    name: "MLI متعدد الطبقات",
                    percentage: 15,
                    color: 0xffffff,
                    description: "للحماية الحرارية",
                    texture: "thermal_blanket"
                },
                titanium: {
                    name: "سبائك التيتانيوم",
                    percentage: 10,
                    color: 0x7f8c8d,
                    description: "للأقفال والمثبتات الرئيسية",
                    texture: "titanium"
                }
            },
            crew: {
                capacity: 6,
                rooms: 6
            },
            mission: {
                duration: 30, // يوم
                destination: "محطة الفضاء الدولية (ISS)"
            },
            rooms: {
                control: { name: "غرفة التحكم", floor: "السفلي", size: "كبير" },
                lab: { name: "المختبر العلمي", floor: "السفلي", size: "كبير" },
                bedroom: { name: "غرف النوم", floor: "العلوي", size: "متوسط" },
                kitchen: { name: "المطبخ", floor: "العلوي", size: "صغير" },
                bathroom: { name: "الحمام", floor: "العلوي", size: "صغير" },
                storage: { name: "التخزين", floor: "السفلي", size: "متوسط" }
            },
            systems: {
                lifeSupport: "خزانات أكسجين متقدمة مع فلترة CO₂",
                pressure: "1 ATM، قابل للتعديل حسب المهمة",
                temperature: "22–24° مئوية",
                communication: "راديو فضائي عالي القدرة، شبكة Wi-Fi داخلية"
            }
        };

        // نظام الذكاء الاصطناعي الرياضي
        const SpaceMissionAI = {
            // ... (نفس الكود السابق) ...
            // حسابات المسافات والأزمنة (بالكيلومتر واليوم)
            distances: {
                iss: 400,        // مدار منخفض حول الأرض
                moon: 384400,    // متوسط المسافة إلى القمر
                mars: 78340000,  // متوسط المسافة إلى المريخ (عند الاقتراب)
                'deep-space': 1500000000 // مسافة افتراضية للفضاء العميق
            },
            
            // سرعات السفر (كم/ساعة)
            speeds: {
                iss: 28000,      // سرعة المحطة الدولية
                moon: 10000,     // سرعة مركبة قمرية
                mars: 50000,     // سرعة مركبة مريخية
                'deep-space': 100000 // سرعة افتراضية للفضاء العميق
            },
            
            // احتياجات أساسية لكل فرد في اليوم
            dailyNeeds: {
                food: 1.8,       // كجم
                water: 3.5,      // لتر
                oxygen: 0.84,    // كجم
                power: 2.5       // كيلوواط/ساعة
            },
            
            // حسابات المهمة
            calculateMission: function(destination, tripType, crewSize, moonDuration = 0) {
                const distance = this.distances[destination];
                const speed = this.speeds[destination];
                
                // حساب زمن السفر (بالأيام)
                let travelTimeOneWay = (distance / speed) / 24; // تحويل من ساعات إلى أيام
                
                // تعديل زمن السفر بناءً على الوجهة
                if (destination === 'moon') {
                    travelTimeOneWay = 3; // 3 أيام إلى القمر (حقيقي)
                } else if (destination === 'mars') {
                    travelTimeOneWay = 210; // 7 أشهر إلى المريخ (حقيقي)
                } else if (destination === 'iss') {
                    travelTimeOneWay = 0.5; // 12 ساعة إلى المحطة الدولية
                }
                
                let totalMissionTime = travelTimeOneWay;
                
                if (tripType === 'round-trip') {
                    totalMissionTime = travelTimeOneWay * 2;
                }
                
                // إضافة مدة البقاء للقمر
                if (destination === 'moon') {
                    totalMissionTime += moonDuration;
                }
                
                // حساب الموارد المطلوبة
                const totalFood = crewSize * this.dailyNeeds.food * totalMissionTime;
                const totalWater = crewSize * this.dailyNeeds.water * totalMissionTime;
                const totalOxygen = crewSize * this.dailyNeeds.oxygen * totalMissionTime;
                const totalPower = crewSize * this.dailyNeeds.power * totalMissionTime;
                
                return {
                    travelTimeOneWay,
                    totalMissionTime: Math.ceil(totalMissionTime),
                    totalFood: Math.ceil(totalFood),
                    totalWater: Math.ceil(totalWater),
                    totalOxygen: Math.ceil(totalOxygen),
                    totalPower: Math.ceil(totalPower)
                };
            },
            
            // توليد توصيات ذكية
            generateRecommendations: function(destination, crewSize, missionData) {
                let recommendations = [];
                
                // توصيات بناءً على الوجهة
                if (destination === 'moon') {
                    recommendations.push({
                        text: "• نظام دعم حياة متقدم لإعادة تدوير المياه",
                        action: () => this.applyWaterRecycling()
                    });
                    recommendations.push({
                        text: "• خزانات أكسجين إضافية",
                        action: () => this.applyExtraOxygen()
                    });
                    recommendations.push({
                        text: "• ألواح شمسية كبيرة لتوليد الطاقة",
                        action: () => this.applySolarPanels()
                    });
                } else if (destination === 'mars') {
                    recommendations.push({
                        text: "• نظام دعم حياة مغلق بالكامل",
                        action: () => this.applyClosedLoopLifeSupport()
                    });
                    recommendations.push({
                        text: "• مفاعل نووي صغير للطاقة",
                        action: () => this.applyNuclearReactor()
                    });
                    recommendations.push({
                        text: "• دفيئة لزراعة الطعام",
                        action: () => this.applyGreenhouse()
                    });
                } else if (destination === 'deep-space') {
                    recommendations.push({
                        text: "• نظام سبات للطاقم لتقليل الاستهلاك",
                        action: () => this.applyHibernationSystem()
                    });
                    recommendations.push({
                        text: "• دفع أيوني متقدم",
                        action: () => this.applyIonPropulsion()
                    });
                    recommendations.push({
                        text: "• درع إشعاعي متطور",
                        action: () => this.applyRadiationShield()
                    });
                }
                
                // توصيات بناءً على حجم الطاقم
                if (crewSize > 6) {
                    recommendations.push({
                        text: "• مساحة معيشة إضافية للطاقم الكبير",
                        action: () => this.applyExtraLivingSpace()
                    });
                }
                
                // توصيات بناءً على مدة المهمة
                if (missionData.totalMissionTime > 180) {
                    recommendations.push({
                        text: "• نظام ترفيه ونشاطات للطاقم",
                        action: () => this.applyEntertainmentSystem()
                    });
                    recommendations.push({
                        text: "• عيادة طبية متكاملة",
                        action: () => this.applyMedicalClinic()
                    });
                }
                
                return recommendations;
            },
            
            // تطبيق التوصيات
            applyWaterRecycling: function() {
                // تخفيض استهلاك الماء بنسبة 40%
                const waterRequired = document.getElementById('water-required');
                const currentValue = parseInt(waterRequired.textContent);
                waterRequired.textContent = `${Math.round(currentValue * 0.6)} لتر`;
                this.showAppliedMessage("تم تطبيق نظام إعادة تدوير المياه");
            },
            
            applyExtraOxygen: function() {
                // زيادة سعة الأكسجين بنسبة 30%
                const oxygenRequired = document.getElementById('oxygen-required');
                const currentValue = parseInt(oxygenRequired.textContent);
                oxygenRequired.textContent = `${Math.round(currentValue * 1.3)} كجم`;
                this.showAppliedMessage("تم إضافة خزانات أكسجين إضافية");
            },
            
            applySolarPanels: function() {
                // زيادة الطاقة المتاحة بنسبة 50%
                const powerRequired = document.getElementById('power-required');
                const currentValue = parseInt(powerRequired.textContent);
                powerRequired.textContent = `${Math.round(currentValue * 1.5)} كيلوواط/ساعة`;
                this.showAppliedMessage("تم تركيب ألواح شمسية إضافية");
            },
            
            applyClosedLoopLifeSupport: function() {
                // تخفيض جميع الاحتياجات بنسبة 25%
                const foodRequired = document.getElementById('food-required');
                const waterRequired = document.getElementById('water-required');
                const oxygenRequired = document.getElementById('oxygen-required');
                
                foodRequired.textContent = `${Math.round(parseInt(foodRequired.textContent) * 0.75)} كجم`;
                waterRequired.textContent = `${Math.round(parseInt(waterRequired.textContent) * 0.75)} لتر`;
                oxygenRequired.textContent = `${Math.round(parseInt(oxygenRequired.textContent) * 0.75)} كجم`;
                
                this.showAppliedMessage("تم تطبيق نظام دعم حياة مغلق");
            },
            
            applyNuclearReactor: function() {
                // زيادة الطاقة بنسبة 200%
                const powerRequired = document.getElementById('power-required');
                const currentValue = parseInt(powerRequired.textContent);
                powerRequired.textContent = `${Math.round(currentValue * 3)} كيلوواط/ساعة`;
                this.showAppliedMessage("تم تركيب مفاعل نووي صغير");
            },
            
            applyGreenhouse: function() {
                // تخفيض الطعام بنسبة 50%
                const foodRequired = document.getElementById('food-required');
                const currentValue = parseInt(foodRequired.textContent);
                foodRequired.textContent = `${Math.round(currentValue * 0.5)} كجم`;
                this.showAppliedMessage("تم إضافة دفيئة لزراعة الطعام");
            },
            
            applyHibernationSystem: function() {
                // تخفيض جميع الاحتياجات بنسبة 60%
                const foodRequired = document.getElementById('food-required');
                const waterRequired = document.getElementById('water-required');
                const oxygenRequired = document.getElementById('oxygen-required');
                const powerRequired = document.getElementById('power-required');
                
                foodRequired.textContent = `${Math.round(parseInt(foodRequired.textContent) * 0.4)} كجم`;
                waterRequired.textContent = `${Math.round(parseInt(waterRequired.textContent) * 0.4)} لتر`;
                oxygenRequired.textContent = `${Math.round(parseInt(oxygenRequired.textContent) * 0.4)} كجم`;
                powerRequired.textContent = `${Math.round(parseInt(powerRequired.textContent) * 0.4)} كيلوواط/ساعة`;
                
                this.showAppliedMessage("تم تطبيق نظام سبات للطاقم");
            },
            
            applyIonPropulsion: function() {
                // تقليل مدة الرحلة بنسبة 30%
                const missionDuration = document.getElementById('mission-duration-display');
                const currentValue = parseInt(missionDuration.textContent);
                missionDuration.textContent = `${Math.round(currentValue * 0.7)} يوم`;
                this.showAppliedMessage("تم تركيب نظام دفع أيوني متقدم");
            },
            
            applyRadiationShield: function() {
                this.showAppliedMessage("تم تركيب درع إشعاعي متطور");
            },
            
            applyExtraLivingSpace: function() {
                // زيادة حجم المسكن بنسبة 20%
                const totalVolume = document.getElementById('total-volume');
                const currentValue = parseInt(totalVolume.textContent);
                totalVolume.textContent = `${Math.round(currentValue * 1.2)} م³`;
                this.showAppliedMessage("تم إضافة مساحة معيشة إضافية");
            },
            
            applyEntertainmentSystem: function() {
                this.showAppliedMessage("تم إضافة نظام ترفيه للطاقم");
            },
            
            applyMedicalClinic: function() {
                this.showAppliedMessage("تم إضافة عيادة طبية متكاملة");
            },
            
            showAppliedMessage: function(message) {
                const messageElement = document.createElement('div');
                messageElement.className = 'ai-applied';
                messageElement.textContent = message;
                
                const aiRec = document.getElementById('ai-recommendation');
                aiRec.appendChild(messageElement);
                
                // إزالة الرسالة بعد 3 ثوانٍ
                setTimeout(() => {
                    messageElement.remove();
                }, 3000);
            },
            
            // فحص التوافق مع معايير ناسا
            checkNASACompliance: function(missionData, crewSize, roomConfig) {
                let issues = [];
                let warnings = [];
                
                // فحص الموارد
                if (missionData.totalFood > 10000) {
                    issues.push("كمية الطعام تتجاوز السعة القصوى");
                } else if (missionData.totalFood > 5000) {
                    warnings.push("كمية الطعام قريبة من الحد الأقصى");
                }
                
                if (missionData.totalWater > 20000) {
                    issues.push("كمية الماء تتجاوز السعة القصوى");
                } else if (missionData.totalWater > 10000) {
                    warnings.push("كمية الماء قريبة من الحد الأقصى");
                }
                
                // فحص المساحة
                const totalVolume = roomConfig.totalVolume;
                const volumePerPerson = totalVolume / crewSize;
                
                if (volumePerPerson < 20) {
                    issues.push(`المساحة للفرد (${volumePerPerson.toFixed(1)} م³) أقل من الحد الأدنى (25 م³)`);
                } else if (volumePerPerson < 25) {
                    warnings.push(`المساحة للفرد (${volumePerPerson.toFixed(1)} م³) قريبة من الحد الأدنى`);
                }
                
                return { issues, warnings };
            }
        };

        // العناصر الرئيسية للمشهد ثلاثي الأبعاد
        let scene, camera, renderer, controls;
        let spaceStation = null;
        let interiorView = false;
        let simulationRunning = false;
        let currentCameraView = 'exterior';
        
        // إدارة الطاقم والغرف
        let crewMembers = ['صلاح الدين عامر', 'علي الربيعي', 'المهندس علي الاكبر', 'زهراء علي', 'دعاء راشد', 'نور عبدالزهرة'];
        let roomConfig = {
            control: { size: 'large', volume: 60, type: 'advanced', quantity: 1 },
            lab: { size: 'large', volume: 60, type: 'advanced', quantity: 1 },
            bedroom: { size: 'medium', volume: 45, type: 'standard', quantity: 6 },
            kitchen: { size: 'small', volume: 30, type: 'compact', quantity: 1 },
            bathroom: { size: 'small', volume: 25, type: 'compact', quantity: 2 },
            storage: { size: 'medium', volume: 50, type: 'standard', quantity: 2 }
        };
        
        // إنشاء مواد واقعية
        function createRealisticMaterial(type, color) {
            switch(type) {
                case 'carbon_fiber':
                    return new THREE.MeshStandardMaterial({ 
                        color: color,
                        roughness: 0.8,
                        metalness: 0.2,
                        bumpScale: 0.05
                    });
                case 'aluminum':
                    return new THREE.MeshStandardMaterial({ 
                        color: color,
                        roughness: 0.3,
                        metalness: 0.8
                    });
                case 'titanium':
                    return new THREE.MeshStandardMaterial({ 
                        color: color,
                        roughness: 0.4,
                        metalness: 0.7
                    });
                case 'thermal_blanket':
                    return new THREE.MeshStandardMaterial({ 
                        color: color,
                        roughness: 0.9,
                        metalness: 0.1
                    });
                default:
                    return new THREE.MeshStandardMaterial({ 
                        color: color,
                        roughness: 0.6,
                        metalness: 0.4
                    });
            }
        }
        
        // تهيئة المشهد ثلاثي الأبعاد
        function init3DScene() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050a20);
            
            const container = document.getElementById('space-station');
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 10, 30);
            
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            
            // إضاءة محسنة
            const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(10, 20, 15);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            const pointLight = new THREE.PointLight(0x4fc3f7, 0.5, 100);
            pointLight.position.set(0, 5, 0);
            scene.add(pointLight);
            
            addStars();
            createSpaceStation();
            animate();
            
            window.addEventListener('resize', onWindowResize);
        }
        
        function addStars() {
            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.1 });
            
            const starVertices = [];
            for (let i = 0; i < 5000; i++) {
                starVertices.push(
                    (Math.random() - 0.5) * 2000,
                    (Math.random() - 0.5) * 2000,
                    (Math.random() - 0.5) * 2000
                );
            }
            
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }
        
        function createSpaceStation() {
            if (spaceStation) scene.remove(spaceStation);
            
            spaceStation = new THREE.Group();
            
            // الجسم الرئيسي (أسطواني مع نهايات نصف كروية)
            const mainBodyGeometry = new THREE.CylinderGeometry(
                nasaStationSpecs.dimensions.diameter / 2, 
                nasaStationSpecs.dimensions.diameter / 2, 
                nasaStationSpecs.dimensions.length, 
                32
            );
            
            const mainBodyMaterial = createRealisticMaterial('carbon_fiber', nasaStationSpecs.materials.external.color);
            const mainBody = new THREE.Mesh(mainBodyGeometry, mainBodyMaterial);
            mainBody.rotation.x = Math.PI / 2;
            mainBody.castShadow = true;
            mainBody.receiveShadow = true;
            spaceStation.add(mainBody);
            
            // النهايات نصف الكروية
            const endCapGeometry = new THREE.SphereGeometry(nasaStationSpecs.dimensions.diameter / 2, 32, 16, 0, Math.PI * 2, 0, Math.PI / 2);
            const endCapMaterial = createRealisticMaterial('carbon_fiber', nasaStationSpecs.materials.external.color);
            
            const frontCap = new THREE.Mesh(endCapGeometry, endCapMaterial);
            frontCap.position.x = nasaStationSpecs.dimensions.length / 2;
            frontCap.castShadow = true;
            spaceStation.add(frontCap);
            
            const backCap = new THREE.Mesh(endCapGeometry, endCapMaterial);
            backCap.position.x = -nasaStationSpecs.dimensions.length / 2;
            backCap.rotation.z = Math.PI;
            backCap.castShadow = true;
            spaceStation.add(backCap);
            
            // الباب الرئيسي (تيتانيوم)
            const doorGeometry = new THREE.CylinderGeometry(
                nasaStationSpecs.dimensions.doorDiameter / 2,
                nasaStationSpecs.dimensions.doorDiameter / 2,
                0.2,
                32
            );
            const doorMaterial = createRealisticMaterial('titanium', nasaStationSpecs.materials.titanium.color);
            
            const mainDoor = new THREE.Mesh(doorGeometry, doorMaterial);
            mainDoor.position.x = nasaStationSpecs.dimensions.length / 2 - 1;
            mainDoor.position.y = -nasaStationSpecs.dimensions.diameter / 4;
            mainDoor.rotation.x = Math.PI / 2;
            mainDoor.castShadow = true;
            spaceStation.add(mainDoor);
            
            // الألواح الشمسية (ألمنيوم)
            const solarPanelGeometry = new THREE.BoxGeometry(8, 0.1, 4);
            const solarPanelMaterial = createRealisticMaterial('aluminum', 0x2c3e50);
            
            const leftSolarPanel = new THREE.Mesh(solarPanelGeometry, solarPanelMaterial);
            leftSolarPanel.position.y = nasaStationSpecs.dimensions.diameter / 2 + 2;
            leftSolarPanel.position.x = 2;
            leftSolarPanel.castShadow = true;
            spaceStation.add(leftSolarPanel);
            
            const rightSolarPanel = new THREE.Mesh(solarPanelGeometry, solarPanelMaterial);
            rightSolarPanel.position.y = -nasaStationSpecs.dimensions.diameter / 2 - 2;
            rightSolarPanel.position.x = 2;
            rightSolarPanel.castShadow = true;
            spaceStation.add(rightSolarPanel);
            
            // إضافة الغرف بناءً على التكوين الحالي
            updateStationRooms();
            
            scene.add(spaceStation);
            updateMissionCalculations();
            updateStationDetails();
        }
        
        function updateStationRooms() {
            // إزالة الغرف القديمة
            spaceStation.children.slice(6).forEach(child => spaceStation.remove(child));
            
            // إضافة الغرف بناءً على التكوين الحالي
            const roomColors = {
                control: 0x2980b9,
                lab: 0x27ae60,
                bedroom: 0x8e44ad,
                kitchen: 0xe74c3c,
                bathroom: 0x3498db,
                storage: 0xf39c12
            };
            
            // توزيع الغرف بشكل منطقي على طول المحطة
            const roomPositions = {
                control: { x: nasaStationSpecs.dimensions.length / 2 - 3, y: 0, z: 0 },
                lab: { x: nasaStationSpecs.dimensions.length / 2 - 8, y: 0, z: 0 },
                bedroom: { x: 0, y: 0, z: 0 },
                kitchen: { x: -nasaStationSpecs.dimensions.length / 2 + 3, y: 0, z: 0 },
                bathroom: { x: -nasaStationSpecs.dimensions.length / 2 + 6, y: 0, z: 0 },
                storage: { x: -nasaStationSpecs.dimensions.length / 2 + 10, y: 0, z: 0 }
            };
            
            Object.keys(roomConfig).forEach(roomType => {
                const room = roomConfig[roomType];
                const basePosition = roomPositions[roomType];
                
                for (let i = 0; i < room.quantity; i++) {
                    const sizeMultiplier = room.size === 'small' ? 0.7 : room.size === 'medium' ? 1.0 : 1.3;
                    
                    const roomGeometry = new THREE.BoxGeometry(
                        3 * sizeMultiplier,
                        3 * sizeMultiplier,
                        3 * sizeMultiplier
                    );
                    
                    const roomMaterial = createRealisticMaterial('aluminum', roomColors[roomType]);
                    roomMaterial.transparent = true;
                    roomMaterial.opacity = 0.8;
                    
                    const roomMesh = new THREE.Mesh(roomGeometry, roomMaterial);
                    
                    // توزيع الغرف بشكل منطقي
                    roomMesh.position.x = basePosition.x + (i * 2);
                    roomMesh.position.y = basePosition.y;
                    roomMesh.position.z = basePosition.z;
                    roomMesh.castShadow = true;
                    roomMesh.receiveShadow = true;
                    
                    spaceStation.add(roomMesh);
                    
                    // إضافة تفاصيل داخلية للغرف
                    if (currentCameraView === 'interior') {
                        addRoomInterior(roomType, roomMesh.position, sizeMultiplier);
                    }
                }
            });
        }
        
        function addRoomInterior(roomType, position, sizeMultiplier) {
            // إضافة تفاصيل داخلية واقعية للغرف
            const interiorGroup = new THREE.Group();
            
            switch(roomType) {
                case 'control':
                    // إضافة لوحات تحكم
                    const controlPanelGeometry = new THREE.BoxGeometry(2 * sizeMultiplier, 0.1, 1 * sizeMultiplier);
                    const controlPanelMaterial = createRealisticMaterial('aluminum', 0x34495e);
                    const controlPanel = new THREE.Mesh(controlPanelGeometry, controlPanelMaterial);
                    controlPanel.position.set(0, -1, 0);
                    interiorGroup.add(controlPanel);
                    break;
                    
                case 'bedroom':
                    // إضافة أسرّة
                    const bedGeometry = new THREE.BoxGeometry(1.5 * sizeMultiplier, 0.2, 0.8 * sizeMultiplier);
                    const bedMaterial = createRealisticMaterial('aluminum', 0x95a5a6);
                    const bed = new THREE.Mesh(bedGeometry, bedMaterial);
                    bed.position.set(0, -0.8, 0);
                    interiorGroup.add(bed);
                    break;
                    
                case 'kitchen':
                    // إضافة معدات مطبخ
                    const counterGeometry = new THREE.BoxGeometry(1.5 * sizeMultiplier, 0.8, 0.6 * sizeMultiplier);
                    const counterMaterial = createRealisticMaterial('aluminum', 0x7f8c8d);
                    const counter = new THREE.Mesh(counterGeometry, counterMaterial);
                    counter.position.set(0, -0.5, 0);
                    interiorGroup.add(counter);
                    break;
            }
            
            interiorGroup.position.copy(position);
            spaceStation.add(interiorGroup);
        }
        
        function updateStationDetails() {
            const detailsContainer = document.getElementById('station-details');
            let detailsHTML = '';
            
            // ... (نفس الكود السابق لتحديث التفاصيل) ...
            // قسم المواصفات العامة
            detailsHTML += `
                <div class="station-details-section">
                    <h4>المواصفات العامة</h4>
                    <p><strong>الأبعاد:</strong> ${nasaStationSpecs.dimensions.length}م طول × ${nasaStationSpecs.dimensions.diameter}م قطر</p>
                    <p><strong>الباب الرئيسي:</strong> دائري بقطر ${nasaStationSpecs.dimensions.doorDiameter}م</p>
                    <p><strong>سعة الطاقم:</strong> ${nasaStationSpecs.crew.capacity} أفراد</p>
                    <p><strong>عدد الغرف:</strong> ${nasaStationSpecs.crew.rooms}</p>
                    <p><strong>مدة الرحلة القياسية:</strong> ${nasaStationSpecs.mission.duration} يوم</p>
                    <p><strong>الوجهة:</strong> ${nasaStationSpecs.mission.destination}</p>
                </div>
            `;
            
            // قسم المواد المستخدمة
            detailsHTML += `
                <div class="station-details-section">
                    <h4>المواد المستخدمة (نسب ناسا)</h4>
                    <div class="material-specs">
            `;
            
            Object.values(nasaStationSpecs.materials).forEach(material => {
                detailsHTML += `
                    <div class="material-spec">
                        <div class="material-name">${material.name}</div>
                        <div class="material-percentage">${material.percentage}%</div>
                        <div style="font-size: 12px; margin-top: 5px;">${material.description}</div>
                    </div>
                `;
            });
            
            detailsHTML += `
                    </div>
                </div>
            `;
            
            // قسم توزيع الغرف
            detailsHTML += `
                <div class="station-details-section">
                    <h4>توزيع الغرف</h4>
            `;
            
            Object.keys(nasaStationSpecs.rooms).forEach(roomType => {
                const room = nasaStationSpecs.rooms[roomType];
                detailsHTML += `<p><strong>${room.name}:</strong> الطابق ${room.floor} - الحجم: ${room.size}</p>`;
            });
            
            detailsHTML += `</div>`;
            
            // قسم أنظمة دعم الحياة
            detailsHTML += `
                <div class="station-details-section">
                    <h4>أنظمة دعم الحياة</h4>
                    <p><strong>نظام الأكسجين:</strong> ${nasaStationSpecs.systems.lifeSupport}</p>
                    <p><strong>الضغط الداخلي:</strong> ${nasaStationSpecs.systems.pressure}</p>
                    <p><strong>التحكم بالحرارة:</strong> ${nasaStationSpecs.systems.temperature}</p>
                    <p><strong>نظام الاتصالات:</strong> ${nasaStationSpecs.systems.communication}</p>
                </div>
            `;
            
            // قسم التفاصيل التقنية
            detailsHTML += `
                <div class="station-details-section">
                    <h4>التفاصيل التقنية</h4>
                    <p><strong>الشكل العام:</strong> أسطواني مع نهايات نصف كروية</p>
                    <p><strong>الطوابق:</strong> طابقين (علوي وسفلي)</p>
                    <p><strong>الممرات:</strong> نصف دائري، بعرض 1.2 متر</p>
                    <p><strong>الأقفال:</strong> ذكية تعمل بالبصمة ونظام RFID</p>
                    <p><strong>الإضاءة:</strong> LED مخفية على طول الحواف الداخلية</p>
                    <p><strong>التصميم الداخلي:</strong> أسلوب مستقبلي نظيف بألوان هادئة</p>
                </div>
            `;
            
            detailsContainer.innerHTML = detailsHTML;
        }
        
        function updateMissionCalculations() {
            const destination = document.getElementById('destination').value;
            const tripType = document.querySelector('.trip-btn.active').id === 'round-trip' ? 'round-trip' : 'one-way';
            const crewSize = crewMembers.length;
            const moonDuration = destination === 'moon' ? parseInt(document.getElementById('moon-duration').value) : 0;
            
            const missionData = SpaceMissionAI.calculateMission(destination, tripType, crewSize, moonDuration);
            const recommendations = SpaceMissionAI.generateRecommendations(destination, crewSize, missionData);
            const compliance = SpaceMissionAI.checkNASACompliance(missionData, crewSize, {
                totalVolume: calculateTotalVolume()
            });
            
            // تحديث واجهة المستخدم
            document.getElementById('mission-duration-display').textContent = `${missionData.totalMissionTime} يوم`;
            document.getElementById('food-required').textContent = `${missionData.totalFood} كجم`;
            document.getElementById('water-required').textContent = `${missionData.totalWater} لتر`;
            document.getElementById('oxygen-required').textContent = `${missionData.totalOxygen} كجم`;
            document.getElementById('power-required').textContent = `${missionData.totalPower} كيلوواط/ساعة`;
            document.getElementById('total-volume').textContent = `${calculateTotalVolume()} م³`;
            document.getElementById('destination-display').textContent = document.getElementById('destination').options[document.getElementById('destination').selectedIndex].text;
            
            // عرض التوصيات مع أزرار التطبيق
            const aiRec = document.getElementById('ai-recommendation');
            aiRec.innerHTML = `<strong>توصيات الذكاء الاصطناعي:</strong><br>`;
            
            recommendations.forEach(rec => {
                const recElement = document.createElement('div');
                recElement.style.marginBottom = '5px';
                recElement.innerHTML = `
                    ${rec.text} 
                    <button style="width: auto; padding: 3px 8px; margin: 0 5px; font-size: 12px;" class="apply-recommendation">تطبيق</button>
                `;
                aiRec.appendChild(recElement);
                
                recElement.querySelector('.apply-recommendation').addEventListener('click', rec.action);
            });
            
            // تحديث مؤشر التوافق
            updateComplianceIndicator(compliance);
            
            // تحديث تفاصيل المسكن
            updateStationDetails();
        }
        
        function calculateTotalVolume() {
            return Object.values(roomConfig).reduce((total, room) => total + (room.volume * room.quantity), 0);
        }
        
        function updateComplianceIndicator(compliance) {
            const red = document.querySelector('.compliance-red');
            const yellow = document.querySelector('.compliance-yellow');
            const green = document.querySelector('.compliance-green');
            
            if (compliance.issues.length > 0) {
                red.style.height = '80px';
                yellow.style.height = '30px';
                green.style.height = '10px';
            } else if (compliance.warnings.length > 0) {
                red.style.height = '10px';
                yellow.style.height = '80px';
                green.style.height = '30px';
            } else {
                red.style.height = '10px';
                yellow.style.height = '30px';
                green.style.height = '80px';
            }
        }
        
        function onWindowResize() {
            const container = document.getElementById('space-station');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            if (spaceStation && !interiorView && simulationRunning) {
                spaceStation.rotation.y += 0.005;
            }
            controls.update();
            renderer.render(scene, camera);
        }
        
        function startSimulation() {
            simulationRunning = true;
            const simulationPanel = document.getElementById('simulation-active');
            const progressBar = document.getElementById('progress-bar');
            const statusText = document.getElementById('simulation-status');
            
            simulationPanel.style.display = 'block';
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 1;
                progressBar.style.width = `${progress}%`;
                
                if (progress <= 25) {
                    statusText.textContent = 'جاري تهيئة أنظمة الدعم الحيوي...';
                } else if (progress <= 50) {
                    statusText.textContent = 'جاري تحميل بيانات الرحلة...';
                } else if (progress <= 75) {
                    statusText.textContent = 'جاري تشغيل أنظمة الطاقة...';
                } else {
                    statusText.textContent = 'جاري إطلاق المحاكاة...';
                }
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        simulationPanel.style.display = 'none';
                        simulationRunning = false;
                        alert('المحاكاة اكتملت بنجاح! تم تحليل بيانات الرحلة الفضائية.');
                    }, 1000);
                }
            }, 50);
        }
        
        function stopSimulation() {
            simulationRunning = false;
            document.getElementById('simulation-active').style.display = 'none';
            document.getElementById('progress-bar').style.width = '0%';
        }
        
        function resetView() {
            if (controls) {
                controls.reset();
                camera.position.set(0, 10, 30);
                currentCameraView = 'exterior';
                updateStationRooms();
            }
        }
        
        function clearModel() {
            if (spaceStation) {
                scene.remove(spaceStation);
                spaceStation = null;
                alert('تم مسح النموذج الحالي. يمكنك إنشاء نموذج جديد.');
            }
        }
        
        function exportModel() {
            if (!spaceStation) {
                alert('لا يوجد نموذج لتصديره!');
                return;
            }
            
            const exporter = new THREE.GLTFExporter();
            exporter.parse(spaceStation, function(gltf) {
                const blob = new Blob([JSON.stringify(gltf)], { type: 'application/octet-stream' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'nasa_space_station.gltf';
                a.click();
                URL.revokeObjectURL(url);
                alert('تم تصدير النموذج بنجاح!');
            });
        }
        
        function setCameraView(view) {
            switch(view) {
                case 'front':
                    camera.position.set(0, 0, 30);
                    camera.lookAt(0, 0, 0);
                    break;
                case 'back':
                    camera.position.set(0, 0, -30);
                    camera.lookAt(0, 0, 0);
                    break;
                case 'top':
                    camera.position.set(0, 30, 0);
                    camera.lookAt(0, 0, 0);
                    break;
                case 'bottom':
                    camera.position.set(0, -30, 0);
                    camera.lookAt(0, 0, 0);
                    break;
            }
            controls.update();
        }
        
        function toggleInteriorView() {
            interiorView = !interiorView;
            currentCameraView = interiorView ? 'interior' : 'exterior';
            
            if (interiorView) {
                // الانتقال إلى المنظر الداخلي
                camera.position.set(0, 0, 5);
                updateStationRooms();
            } else {
                // العودة إلى المنظر الخارجي
                camera.position.set(0, 10, 30);
                updateStationRooms();
            }
        }
        
        function updateCrewList() {
            const crewList = document.getElementById('crew-list');
            crewList.innerHTML = '';
            
            crewMembers.forEach((member, index) => {
                const memberDiv = document.createElement('div');
                memberDiv.className = 'crew-member';
                memberDiv.innerHTML = `
                    <span class="crew-name">${member}</span>
                    <button class="remove-btn" data-index="${index}">إزالة</button>
                `;
                crewList.appendChild(memberDiv);
            });
            
            document.querySelectorAll('.remove-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    crewMembers.splice(index, 1);
                    updateCrewList();
                    updateMissionCalculations();
                });
            });
            
            document.getElementById('crew-count').textContent = crewMembers.length;
        }
        
        function updateRoomInfo(roomType) {
            const room = roomConfig[roomType];
            const roomDetails = document.getElementById('room-details');
            const sizeNames = { small: 'صغير', medium: 'متوسط', large: 'كبير' };
            const typeNames = { standard: 'قياسي', advanced: 'متقدم', luxury: 'فاخر', compact: 'مدمج' };
            
            roomDetails.innerHTML = `
                <strong>${getRoomName(roomType)}</strong><br>
                الحجم: ${room.volume} م³<br>
                المستوى: ${sizeNames[room.size]}<br>
                النوع: ${typeNames[room.type]}<br>
                العدد: ${room.quantity}
            `;
            
            document.getElementById('room-quantity').textContent = room.quantity;
        }
        
        function getRoomName(roomType) {
            const names = {
                control: 'غرفة التحكم',
                lab: 'المختبر العلمي',
                bedroom: 'غرف النوم',
                kitchen: 'المطبخ',
                bathroom: 'الحمام',
                storage: 'التخزين'
            };
            return names[roomType];
        }
        
        // أحداث الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            // إظهار شاشة الترحيب أولاً
            document.getElementById('welcome-screen').style.display = 'flex';
            document.getElementById('main-container').style.display = 'none';
            
            // حدث بدء المحاكاة
            document.getElementById('start-button').addEventListener('click', function() {
                document.getElementById('welcome-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('welcome-screen').style.display = 'none';
                    document.getElementById('main-container').style.display = 'flex';
                    document.getElementById('main-container').style.opacity = '1';
                    
                    // تهيئة المحاكاة بعد إظهار الواجهة الرئيسية
                    init3DScene();
                    updateCrewList();
                    updateMissionCalculations();
                }, 800);
            });
            
            // أحداث الوجهة ونوع الرحلة
            document.getElementById('destination').addEventListener('change', function() {
                const moonOptions = document.getElementById('moon-options');
                moonOptions.style.display = this.value === 'moon' ? 'block' : 'none';
                updateMissionCalculations();
            });
            
            document.querySelectorAll('.trip-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.trip-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateMissionCalculations();
                });
            });
            
            document.getElementById('moon-duration').addEventListener('change', updateMissionCalculations);
            
            // أحداث الطاقم
            document.getElementById('add-crew').addEventListener('click', function() {
                const nameInput = document.getElementById('crew-name');
                const name = nameInput.value.trim();
                if (name) {
                    crewMembers.push(name);
                    updateCrewList();
                    updateMissionCalculations();
                    nameInput.value = '';
                }
            });
            
            // أحداث الغرف
            document.querySelectorAll('.room-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.room-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const roomType = this.getAttribute('data-room');
                    updateRoomInfo(roomType);
                });
            });
            
            document.querySelectorAll('.size-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const size = this.getAttribute('data-size');
                    const activeRoom = document.querySelector('.room-btn.active').getAttribute('data-room');
                    
                    // تحديث حجم الغرفة
                    const baseVolumes = {
                        control: 60, lab: 60, bedroom: 45, kitchen: 30, bathroom: 25, storage: 50
                    };
                    
                    const multipliers = { small: 0.7, medium: 1.0, large: 1.3 };
                    roomConfig[activeRoom] = {
                        ...roomConfig[activeRoom],
                        size: size,
                        volume: Math.round(baseVolumes[activeRoom] * multipliers[size])
                    };
                    
                    updateRoomInfo(activeRoom);
                    updateMissionCalculations();
                    updateStationRooms();
                });
            });
            
            document.querySelectorAll('.room-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.room-type-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const type = this.getAttribute('data-type');
                    const activeRoom = document.querySelector('.room-btn.active').getAttribute('data-room');
                    
                    roomConfig[activeRoom] = {
                        ...roomConfig[activeRoom],
                        type: type
                    };
                    
                    updateRoomInfo(activeRoom);
                    updateMissionCalculations();
                });
            });
            
            // أحداث زيادة ونقصان عدد الغرف
            document.getElementById('increase-room').addEventListener('click', function() {
                const activeRoom = document.querySelector('.room-btn.active').getAttribute('data-room');
                roomConfig[activeRoom].quantity++;
                updateRoomInfo(activeRoom);
                updateMissionCalculations();
                updateStationRooms();
            });
            
            document.getElementById('decrease-room').addEventListener('click', function() {
                const activeRoom = document.querySelector('.room-btn.active').getAttribute('data-room');
                if (roomConfig[activeRoom].quantity > 1) {
                    roomConfig[activeRoom].quantity--;
                    updateRoomInfo(activeRoom);
                    updateMissionCalculations();
                    updateStationRooms();
                }
            });
            
            // أحداث الأزرار الرئيسية
            document.getElementById('simulate-btn').addEventListener('click', startSimulation);
            document.getElementById('stop-simulation').addEventListener('click', stopSimulation);
            document.getElementById('reset-view').addEventListener('click', resetView);
            document.getElementById('clear-model').addEventListener('click', clearModel);
            document.getElementById('export-model').addEventListener('click', exportModel);
            
            // أحداث الكاميرات
            document.getElementById('camera-front').addEventListener('click', () => setCameraView('front'));
            document.getElementById('camera-back').addEventListener('click', () => setCameraView('back'));
            document.getElementById('camera-top').addEventListener('click', () => setCameraView('top'));
            document.getElementById('camera-bottom').addEventListener('click', () => setCameraView('bottom'));
            
            // أحداث عرض التفاصيل
            document.getElementById('details-btn').addEventListener('click', function() {
                document.getElementById('details-panel').style.display = 'block';
            });
            
            document.getElementById('close-details').addEventListener('click', function() {
                document.getElementById('details-panel').style.display = 'none';
            });
            
            // أحداث المناظر
            document.getElementById('exterior-view').addEventListener('click', function() {
                interiorView = false;
                currentCameraView = 'exterior';
                camera.position.set(0, 10, 30);
                updateStationRooms();
            });
            
            document.getElementById('interior-view').addEventListener('click', toggleInteriorView);
            
            // تهيئة أولية
            updateRoomInfo('control');
        });
    </script>
</body>

</html>
